<!DOCTYPE html>
<html>
<head>
  <title>Senior Request</title>
  <link rel='stylesheet' href='/styles/bootstrap.min.css' />
  <link rel='stylesheet' href='/styles/style.css' />
  <script src="/js/jquery-2.2.0.min.js" type="text/javascript"></script>
  <script src="/js/bootstrap.min.js" type="text/javascript"></script>
</head>
<body>
<div>
  <nav class="navbar navbar-inverse" style="padding-left: 130px;">
    <ul class="nav navbar-nav">
      <li class="active"><a href="/">Home</a></li>
      <li><a href="/">Logout</a></li>
    </ul>
  </nav>
</div>

<div class="center">
  <h1>Decision</h1>
  <br/>
  <form class="form-horizontal" style="width: 50%;">
    <div class="form-group">
      <label for="routename" class="col-sm-2 control-label">ID Request</label>
      <div class="col-sm-10">
        <input type="text" class="form-control" id="IDreq" name="IDreq" placeholder="ID Request" value="">
      </div>
    </div>
    <br/>
    <br/>
    <div class="form-group">
     <div class="form-group">
          <div class="col-sm-offset-2 col-sm-5">
            <input id="btnAccept" name="btnAccept" type="button" value="Accept" class="btn btn-primary">
          </div>
          <div class="col-sm-5">
            <input id="btnReject" name="btnReject" type="button" value="Reject" class="btn btn-primary">
          </div>
        </div>
        </div>
      </form>
  <br/>
  <br/>
  <br/>
  
  <table class="table">
    <thead>
    <tr>
      <th scope="col">ID</th>
      <th scope="col">Status</th>
      <th scope="col">UserId</th>
      <th scope="col">refund amount</th>
      <th scope="col">ticket id</th>
    </tr>
    {{#request}}
    <tr>
      <td>{{id}}</td>
      <td>{{status}}</td>
      <td>{{userid}}</td>
      <td>{{refundamount}}</td>
      <td>{{ticketid}}</td>
    </tr>
    {{/request}}
    </thead>
    <tbody id="requestsTableBody">

    </tbody>
  </table>
</div>

<script>
  $(document).ready(function() {
    $("#btnAccept").click(function() {
      const IDreq = $('#IDreq').val();

      if (!IDreq) {
        alert('All fields are required');
        return;
      }

      const data = {
        reqStatus: 'accepted',
      };

      $.ajax({
        type: "PUT",
        url: '/api/v1/requests/refunds/' + IDreq,
        data: JSON.stringify(data),
        contentType: 'application/json',
        success: function(serverResponse) {
          if (serverResponse) {
            alert('Successfully accepted request');
            location.reload();
          }
        },
        error: function(errorResponse) {
          if (errorResponse) {
            alert(`Error in accepting request: ${errorResponse.responseText}`);
          }
        }
      });
    });

    $("#btnReject").click(function() {
      const IDreq = $('#IDreq').val();

      if (!IDreq) {
        alert('All fields are required');
        return;
      }

      const data = {
        reqStatus: 'rejected',
      };

      $.ajax({
        type: "PUT",
        url: '/api/v1/requests/refunds/' + IDreq,
        data: JSON.stringify(data),
        contentType: 'application/json',
        success: function(serverResponse) {
          if (serverResponse) {
            alert('Successfully rejected request');
            location.reload();
          }
        },
        error: function(errorResponse) {
          if (errorResponse) {
            alert(`Error in rejecting request: ${errorResponse.responseText}`);
          }
        }
      });
    });
  });
</script>
</body>
</html>
